<div class="dashboard-container" [class.rtl]="lang.currentLanguage === 'he'">
  <!-- Header Section with Logo and Greeting -->
  <div class="dashboard-header">
	  <div class="header-content">
		  <div class="logo-container">
			  @if (logoUrl) {
				  <img [src]="logoUrl" alt="Business Logo" class="logo">
			  } @else {
				  <img src="/img/logo.png" alt="iHoogi Avatar" class="logo">
			  }
		  </div>
		  <div class="welcome-box">
			  <h1 class="welcome-title">
				  {{ lang.t('dashboard.hello') }} {{ userName }} 
			  </h1>
			  <p class="welcome-subtitle">{{ lang.t('dashboard.myBusiness') }} {{ businessName }}</p>
		  </div>
	  </div>

    <div>
      <button (click)="goNew()" class="create-btn">
        {{ lang.t('dashboard.newQuestionnaire') }}
      </button>
    </div>
  </div>

  <!-- Thin Summary Bars -->
  <div class="summary-bars-container">
    <!-- Leads Analysis Bar -->
    <div class="summary-bar summary-bar-leads">
      <div class="subscription-section">
        <div class="subscription-section-header">
          <div class="subscription-icon-wrapper subscription-icon-orange">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 3v18"></path>
              <path d="M18 3v18"></path>
              <path d="M6 8h12"></path>
              <path d="M6 12h12"></path>
              <path d="M6 16h12"></path>
              <circle cx="12" cy="8" r="1.5" fill="white"></circle>
              <circle cx="12" cy="12" r="1.5" fill="white"></circle>
              <circle cx="12" cy="16" r="1.5" fill="white"></circle>
            </svg>
          </div>
          <h3 class="subscription-section-title">{{ lang.currentLanguage === 'he' ? ' 砖转专' : 'Remaining Leads' }}</h3>
        </div>
        <div class="subscription-section-main">
          <div class="subscription-ratio">{{ remainingLeads }}</div>
          <div class="subscription-progress-bar">
            <div class="subscription-progress-fill subscription-progress-orange" [style.width.%]="leadsProgress"></div>
          </div>
        </div>
        <div class="subscription-section-details">
          <div class="subscription-detail-row">
            <span class="subscription-detail-label">{{ lang.currentLanguage === 'he' ? ' ' : 'Leads in Subscription' }}:</span>
            <span class="subscription-detail-value">{{ utilizedLeads }}/{{ totalLeadQuota }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- New Leads Bar (Clickable) -->
    <div class="summary-bar summary-bar-new-leads" (click)="viewNewLeads()">
      <div class="summary-bar-content summary-bar-clickable">
        <div class="summary-bar-item">
          <span class="summary-bar-label">{{ lang.currentLanguage === 'he' ? '砖' : 'New' }}:</span>
          <span class="summary-bar-value">{{ newLeadsCount }}</span>
        </div>
        <div class="summary-bar-action">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </div>
      </div>
    </div>

    <!-- Reminder Leads Bar (Clickable) -->
    <div class="summary-bar summary-bar-reminder-leads" (click)="viewReminderLeads()">
      <div class="summary-bar-content summary-bar-clickable">
        <div class="summary-bar-item">
          <span class="summary-bar-label">{{ lang.currentLanguage === 'he' ? ' 转专转' : 'Leads in Reminder' }}:</span>
          <span class="summary-bar-value">{{ reminderLeadsCount }}</span>
        </div>
        <div class="summary-bar-action">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </div>
      </div>
    </div>
  </div>

  <!-- Messages and Emails Bars (Full Width) -->
  <div class="subscription-bars-container">
    <!-- Messages Bar (Full Width) -->
    <div class="summary-bar summary-bar-messages">
      <div class="subscription-section">
        <div class="subscription-section-header">
          <div class="subscription-icon-wrapper subscription-icon-green">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
          </div>
          <h3 class="subscription-section-title">{{ lang.t('dashboard.messages') }}</h3>
        </div>
        <div class="subscription-section-main">
          <div class="subscription-ratio">285/600</div>
          <div class="subscription-progress-bar">
            <div class="subscription-progress-fill subscription-progress-green" [style.width.%]="47.5"></div>
          </div>
        </div>
        <div class="subscription-section-details">
          <div class="subscription-detail-row">
            <span class="subscription-detail-label">{{ lang.t('dashboard.used') }}:</span>
            <span class="subscription-detail-value">285</span>
          </div>
          <div class="subscription-detail-row">
            <span class="subscription-detail-label">{{ lang.t('dashboard.remaining') }}:</span>
            <span class="subscription-detail-value">315</span>
          </div>
          <div class="subscription-breakdown">
            <div class="subscription-breakdown-item">
              <span class="subscription-breakdown-label">{{ lang.t('dashboard.total') }}:</span>
              <span>WhatsApp 35 路 SMS 250</span>
            </div>
            <div class="subscription-breakdown-item">
              <span class="subscription-breakdown-label">{{ lang.t('dashboard.customerResponse') }}:</span>
              <span>WhatsApp 20 路 SMS 180</span>
            </div>
            <div class="subscription-breakdown-item">
              <span class="subscription-breakdown-label">{{ lang.t('dashboard.reminders') }}:</span>
              <span>WhatsApp 15 路 SMS 70</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Emails Bar (Full Width) -->
    <div class="summary-bar summary-bar-emails">
      <div class="subscription-section">
        <div class="subscription-section-header">
          <div class="subscription-icon-wrapper subscription-icon-blue">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
              <polyline points="22,6 12,13 2,6"></polyline>
            </svg>
          </div>
          <h3 class="subscription-section-title">{{ lang.t('dashboard.emails') }}</h3>
        </div>
        <div class="subscription-section-main">
          <div class="subscription-ratio">702/900</div>
          <div class="subscription-progress-bar">
            <div class="subscription-progress-fill subscription-progress-blue" [style.width.%]="78"></div>
          </div>
        </div>
        <div class="subscription-section-details">
          <div class="subscription-detail-row">
            <span class="subscription-detail-label">{{ lang.t('dashboard.used') }}:</span>
            <span class="subscription-detail-value">702</span>
          </div>
          <div class="subscription-detail-row">
            <span class="subscription-detail-label">{{ lang.t('dashboard.remaining') }}:</span>
            <span class="subscription-detail-value">198</span>
          </div>
          <div class="subscription-breakdown">
            <div class="subscription-breakdown-item">
              <span class="subscription-breakdown-label">{{ lang.t('dashboard.response') }}:</span>
              <span>420</span>
            </div>
            <div class="subscription-breakdown-item">
              <span class="subscription-breakdown-label">{{ lang.t('dashboard.reminders') }}:</span>
              <span>282</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Visual Charts Section -->
  <div class="charts-section">
    <!-- Channels Chart -->
    <div class="chart-card">
      <h2 class="chart-title">{{ lang.t('dashboard.leadsByChannel') }}</h2>
      <div class="chart-body">
        <div class="chart-content">
          <!-- Stats List -->
          <div class="stats-list">
            @for (item of channelData; track item.id) {
              <div class="stat-item">
                <div class="stat-item-left">
                  <div class="stat-dot" [style.background-color]="item.color"></div>
                  <span class="stat-name">{{ item.name }}</span>
                </div>
                <span class="stat-value" [style.color]="item.color">{{ item.count }}</span>
              </div>
            }
          </div>

          <!-- Pie Chart Placeholder -->
          <div class="pie-chart-placeholder">
            <svg viewBox="0 0 200 200" class="pie-chart-svg">
              <circle cx="100" cy="100" r="80" fill="#8B5CF6" opacity="0.9"></circle>
              <path d="M 100 100 L 100 20 A 80 80 0 0 1 171.42 71.42 Z" fill="#EC4899"></path>
              <path d="M 100 100 L 171.42 71.42 A 80 80 0 0 1 171.42 128.58 Z" fill="#10B981"></path>
              <path d="M 100 100 L 171.42 128.58 A 80 80 0 0 1 100 180 Z" fill="#3B82F6"></path>
            </svg>
          </div>
        </div>
      </div>
    </div>

    <!-- Partners Chart -->
    <div class="chart-card">
      <h2 class="chart-title">{{ lang.t('dashboard.leadsByPartner') }}</h2>
      <div class="chart-body">
        <div class="chart-content">
          <!-- Stats List -->
          <div class="stats-list">
            @for (item of partnerData; track item.id) {
              <div class="stat-item">
                <div class="stat-item-left">
                  <div class="stat-dot" [style.background-color]="item.color"></div>
                  <span class="stat-name">{{ item.name }}</span>
                </div>
                <span class="stat-value" [style.color]="item.color">{{ item.count }}</span>
              </div>
            }
          </div>

          <!-- Pie Chart Placeholder -->
          <div class="pie-chart-placeholder">
            <svg viewBox="0 0 200 200" class="pie-chart-svg">
              <circle cx="100" cy="100" r="80" fill="#8B5CF6" opacity="0.9"></circle>
              <path d="M 100 100 L 100 20 A 80 80 0 0 1 151.42 51.42 Z" fill="#EC4899"></path>
              <path d="M 100 100 L 151.42 51.42 A 80 80 0 0 1 180 100 Z" fill="#10B981"></path>
            </svg>
          </div>
        </div>

        <!-- Additional Stats -->
        <div class="partner-stats-grid">
          <div class="partner-stat partner-stat-blue">
            <div class="partner-stat-number">{{ partnerStats.total }}</div>
            <div class="partner-stat-label">{{ lang.t('dashboard.totalLeadsCount') }}</div>
          </div>
          <div class="partner-stat partner-stat-green">
            <div class="partner-stat-number">{{ partnerStats.new }}</div>
            <div class="partner-stat-label">{{ lang.t('dashboard.new') }}</div>
          </div>
          <div class="partner-stat partner-stat-purple">
            <div class="partner-stat-number">{{ partnerStats.average }}</div>
            <div class="partner-stat-label">{{ lang.t('dashboard.averagePerPartner') }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- My Questionnaires Section -->
  <div class="questionnaires-section">
    <h2 class="section-title">{{ lang.t('dashboard.myQuestionnaires') }}</h2>

    @if (loading) {
      <div class="loading-state">{{ lang.t('common.loading') }}</div>
    } @else if (questionnaires.length === 0) {
      <div class="empty-state">
        <p>{{ lang.t('dashboard.noQuestionnairesYet') }}</p>
        <button (click)="goNew()" class="create-first-btn">
          {{ lang.t('dashboard.createFirst') }}
        </button>
      </div>
    } @else {
      <div class="questionnaires-list">
        @for (q of questionnaires; track q.id; let idx = $index) {
          <div class="questionnaire-card" [class]="'questionnaire-card-' + (idx % 4)">
            <div class="questionnaire-content">
              <!-- Left side - Title and Date -->
              <div class="questionnaire-info">
                <div class="questionnaire-header">
                  <h3 class="questionnaire-title">{{ q.title }}</h3>
                  <p class="questionnaire-subtitle">{{ q.subtitle }}</p>
                </div>
                <div class="questionnaire-date">
                  <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                  <span>{{ q.date }}</span>
                </div>
              </div>

              <!-- Stats -->
              <div class="questionnaire-stats">
                <div class="stat-box">
                  <div class="stat-box-value">{{ q.leads.total }}</div>
                  <div class="stat-box-label">{{ lang.t('dashboard.leads') }}</div>
                </div>
                <div class="stat-box">
                  <div class="stat-box-value stat-box-value-blue">{{ q.leads.new }}</div>
                  <div class="stat-box-label">{{ lang.t('dashboard.new') }}</div>
                </div>
              </div>

              <!-- Sources and Partners -->
              <div class="questionnaire-meta">
                <div>
                  <span class="meta-label">{{ lang.t('dashboard.channels') }}: </span>
                  <span class="meta-value">{{ q.sources.length }}</span>
                </div>
                <div>
                  <span class="meta-label">{{ lang.t('dashboard.partners') }}: </span>
                  <span class="meta-value">{{ q.partners.length }}</span>
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="questionnaire-actions">
                <button (click)="viewQuestionnaireForm(q.id)" class="action-btn action-btn-outline">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                  {{ lang.t('dashboard.view') }}
                </button>
                <button (click)="viewQuestionnaireStats(q.id)" class="action-btn action-btn-outline">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>
                  {{ lang.t('dashboard.statistics') }}
                </button>
                <button (click)="editQuestionnaire(q.id)" class="action-btn action-btn-outline">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                  {{ lang.t('dashboard.edit') }}
                </button>
                <button (click)="shareQuestionnaire(q.id)" class="action-btn action-btn-outline">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>
                  {{ lang.t('dashboard.share') }}
                </button>
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>
